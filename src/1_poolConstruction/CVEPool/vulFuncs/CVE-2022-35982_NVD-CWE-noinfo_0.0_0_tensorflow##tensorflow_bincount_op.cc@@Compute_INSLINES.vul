+#include "tensorflow/core/kernels/sparse_utils.h"
+    const Tensor& values = ctx->input(1);
+    const auto values_flat = values.flat();
+    OP_REQUIRES_OK(
+        ctx, sparse_utils::ValidateSparseTensor(
+                 indices, values, dense_shape, /*validate_indices=*/true));
+                           ctx, values_flat, weights, out, size));
+                     ctx, values_flat, weights, out, size));
+        const Tidx bin = values_flat(i);
